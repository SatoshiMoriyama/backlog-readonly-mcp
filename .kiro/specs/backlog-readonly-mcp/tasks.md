# 実装計画: Backlog読み取り専用MCP

## 概要

TypeScript と Node.js を使用して Backlog 読み取り専用 MCP サーバーを実装します。環境変数とワークスペース固有の設定ファイル（.backlog-mcp.env）を使用し、セキュリティを重視した読み取り専用のツールセットを提供します。

## タスク

- [ ] 1. プロジェクト構造とコア設定の構築
  - TypeScript プロジェクトの初期化
  - 必要な依存関係のインストール（@modelcontextprotocol/sdk、dotenv、axios 等）
  - プロジェクト構造の作成
  - _要件: 1.4, 5.1_

- [ ]* 1.1 プロパティテスト用の設定読み込み機能
  - **プロパティ 2: 設定読み込みの一貫性**
  - **検証対象: 要件 1.4**

- [ ] 2. 設定管理と API クライアントの実装
  - [ ] 2.1 設定管理クラスの実装
    - 環境変数と.backlog-mcp.env ファイルからの設定読み込み
    - 設定の優先順位処理（ワークスペース設定 > システム環境変数）
    - _要件: 1.4_

  - [ ]* 2.2 設定読み込みのプロパティテスト
    - **プロパティ 2: 設定読み込みの一貫性**
    - **検証対象: 要件 1.4**

  - [ ] 2.3 BacklogAPI クライアントの実装
    - HTTP GET リクエストのみを使用する API クライアント
    - API キーのマスキング機能
    - レート制限処理
    - _要件: 1.1, 1.2, 1.3, 6.1, 6.2, 7.4_

  - [ ]* 2.4 認証処理のプロパティテスト
    - **プロパティ 1: 認証処理の包括性**
    - **検証対象: 要件 1.1, 1.2, 1.3**

- [ ] 3. MCP サーバーコアの実装
  - [ ] 3.1 MCP サーバーの基本構造
    - @modelcontextprotocol/sdk を使用した MCP サーバーの実装
    - ツールレジストリの基本構造
    - _要件: 5.1, 5.2, 5.3_

  - [ ] 3.2 チェックポイント - MCP サーバー基本動作確認
    - MCP サーバーが正常に起動することを確認
    - MCP クライアントからの接続が成功することを確認
    - ツール一覧が正しく返されることを確認

  - [ ]* 3.3 MCPプロトコル準拠のプロパティテスト
    - **プロパティ 7: MCPプロトコル準拠性**
    - **検証対象: 要件 5.1, 5.2, 5.3, 5.4, 5.5**

- [ ] 4. プロジェクト関連ツールの実装
  - [ ] 4.1 プロジェクト取得ツールの実装
    - get_projects: プロジェクト一覧取得
    - get_project: プロジェクト詳細取得
    - get_project_users: プロジェクトメンバー取得
    - デフォルトプロジェクト機能の実装
    - _要件: 2.1, 2.2, 2.4, 9.1_

  - [ ] 4.2 チェックポイント - プロジェクトツール動作確認
    - 各プロジェクトツールが正常に動作することを確認
    - 実際の Backlog API からデータが取得できることを確認
    - デフォルトプロジェクト機能が正しく動作することを確認

  - [ ]* 4.3 プロジェクト取得のプロパティテスト
    - **プロパティ 3: プロジェクト取得の正確性**
    - **検証対象: 要件 2.1, 2.2, 2.4**

- [ ] 5. 課題関連ツールの実装
  - [ ] 5.1 課題取得ツールの実装
    - get_issues: 課題一覧取得（検索条件付き）
    - get_issue: 課題詳細取得
    - get_issue_comments: 課題コメント取得
    - get_issue_attachments: 課題添付ファイル取得
    - _要件: 3.1, 3.2, 3.3, 3.4, 9.2_

  - [ ] 5.2 チェックポイント - 課題ツール動作確認
    - 各課題ツールが正常に動作することを確認
    - 課題検索機能が正しく動作することを確認
    - 課題詳細とコメント取得が正常に動作することを確認

  - [ ]* 5.3 課題取得のプロパティテスト
    - **プロパティ 4: 課題取得と検索の正確性**
    - **検証対象: 要件 3.1, 3.2, 3.3, 3.4**

- [ ] 6. ユーザー・Wiki・マスタデータツールの実装
  - [ ] 6.1 ユーザー関連ツールの実装
    - get_users: ユーザー一覧取得
    - get_user: ユーザー詳細取得
    - get_myself: 自分のユーザー情報取得
    - _要件: 4.1, 4.2, 4.3, 9.3_

  - [ ] 6.2 Wiki 関連ツールの実装
    - get_wikis: Wiki 一覧取得
    - get_wiki: 特定Wikiページ取得
    - _要件: 9.4_

  - [ ] 6.3 マスタデータ関連ツールの実装
    - get_priorities: 優先度一覧取得
    - get_statuses: ステータス一覧取得
    - get_resolutions: 完了理由一覧取得
    - get_categories: カテゴリ一覧取得
    - _要件: 9.5_

  - [ ] 6.4 チェックポイント - 残りツール動作確認
    - ユーザー、Wiki、マスタデータツールが正常に動作することを確認
    - 全ツールが統合されて正しく動作することを確認

  - [ ]* 6.5 ユーザー情報取得のプロパティテスト
    - **プロパティ 5: ユーザー情報取得の正確性**
    - **検証対象: 要件 4.1, 4.2, 4.3**

- [ ] 7. エラーハンドリングと読み取り専用制限の実装
  - [ ] 7.1 包括的エラーハンドリングの実装
    - API エラー、ネットワークエラー、レート制限の処理
    - ユーザーフレンドリーなエラーメッセージ
    - ログ機能の実装
    - _要件: 7.1, 7.2, 7.3, 7.4, 7.5_

  - [ ] 7.2 読み取り専用制限の実装
    - GET リクエストのみの制限
    - データ変更を試みる呼び出しの拒否
    - ツール説明への読み取り専用明記
    - _要件: 6.1, 6.2, 6.3, 6.4_

  - [ ]* 7.3 エラーハンドリングのプロパティテスト
    - **プロパティ 10: エラーハンドリングの包括性**
    - **検証対象: 要件 7.1, 7.2, 7.3, 7.4, 7.5**

  - [ ]* 7.4 読み取り専用制限のプロパティテスト
    - **プロパティ 8: 読み取り専用制限の徹底**
    - **検証対象: 要件 6.1, 6.2, 6.3**

- [ ] 8. チェックポイント - 基本機能の動作確認
  - すべてのテストが通ることを確認し、ユーザーに質問があれば対応する

- [ ] 9. 統合とツール登録
  - [ ] 9.1 全ツールの統合とレジストリ登録
    - すべてのツールを MCP サーバーに登録
    - ツール間の連携機能の実装
    - _要件: 5.3, 5.4, 9.6, 9.7_

  - [ ]* 9.2 統合テストとプロパティテスト
    - **プロパティ 6: 存在しないリソースのエラーハンドリング**
    - **プロパティ 9: ツール説明の読み取り専用明記**
    - **プロパティ 11: 公式サーバーとの差別化**
    - **プロパティ 12: 各ツールの正確な実装**
    - **検証対象: 要件 2.3, 3.5, 4.4, 6.4, 8.1, 8.2, 8.3, 8.5, 9.1-9.7**

- [ ] 10. ビルドとパッケージング
  - [ ] 10.1 本番用ビルド設定
    - TypeScript コンパイル設定
    - 実行可能ファイルの作成
    - package.json の最終調整

  - [ ] 10.2 ドキュメントとサンプル設定の作成
    - README.md の作成
    - .backlog-mcp.env.example ファイルの作成
    - MCP クライアント設定例の提供
    - _要件: 8.4_

- [ ] 11. 最終チェックポイント - 全機能の動作確認
  - すべてのテストが通ることを確認し、ユーザーに質問があれば対応する

## 注意事項

- `*` マークの付いたタスクはオプションで、より迅速な MVP のためにスキップ可能
- 各タスクは特定の要件への参照を含み、トレーサビリティを確保
- **各ツール実装後にチェックポイントを設けて早期の動作確認を実施**
- プロパティテストは正確性プロパティの検証を行う
- ユニットテストは特定の例とエッジケースの検証を行う